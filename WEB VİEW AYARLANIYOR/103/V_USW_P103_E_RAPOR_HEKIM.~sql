--CREATE OR REPLACE VIEW V_USW_P103_E_RAPOR_HEKIM AS
SELECT
ER.ID AS DETAY_ID,
NVL(PR.P_TCKIMLIK,PR2.P_TCKIMLIK) AS HEKIM_KIMLIK_NUMARASI#Z
FROM E_HASTARAPOR ER
LEFT JOIN H_POLIKLINIK P ON P.ID=ER.YAZIMYERID AND P.HKID=ER.HKID AND ER.YAZIMYER=1
LEFT JOIN H_YHSERVIS YHS ON YHS.ID=ER.YAZIMYERID AND YHS.HKID=ER.HKID AND ER.YAZIMYER=2
LEFT JOIN FONETHBYSADM.H_PERSON PR ON PR.P_ID=YHS.DOKTORID
LEFT JOIN FONETHBYSADM.H_PERSON PR2 ON PR2.P_ID=P.DOKTORID
LEFT JOIN H_HASTAKAYIT X ON X.HK_ID=ER.HKID
WHERE ER.ETAR > '01.01.2015'
AND NVL(ER.RAPORNO,0) > 0
AND NVL(ER.DURUM,'-') = '+'
UNION ALL
SELECT
ER.ID AS DETAY_ID,
PR.P_TCKIMLIK AS HEKIM_KIMLIK_NUMARASI
FROM E_HASTARAPOR ER
INNER JOIN E_HASTARAPOR_HEYETDR HYT ON HYT.RAPORID=ER.ID
INNER JOIN FONETHBYSADM.H_PERSON PR ON PR.P_ID=HYT.DRID
LEFT JOIN H_HASTAKAYIT X ON X.HK_ID=ER.HKID
WHERE ER.ETAR > '01.01.2015'
AND NVL(ER.RAPORNO,0) > 0
AND NVL(ER.DURUM,'-') = '+';
