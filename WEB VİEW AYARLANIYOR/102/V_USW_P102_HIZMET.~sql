SELECT
            "BS"."HASTA_GELIS_ID" AS HK_ID,
            "HH"."ID" AS DETAY_ID,
            (select U.SKRS_KODU from FONETHBS.UZMANLIK U WHERE U.KODU IN (SELECT X.UZMANLIK_KODU FROM FONETHBS.BIRIM X WHERE X.ID = BS.BIRIM_ID))  AS KLINIK_KODU#K,
            USS.GET_GUID_VALUE('c04bee57-c5d4-443d-e040-7b0a6f146a3d',(select U.SKRS_KODU from FONETHBS.UZMANLIK U WHERE U.KODU IN (SELECT X.UZMANLIK_KODU FROM FONETHBS.BIRIM X WHERE X.ID = BS.BIRIM_ID))) AS KLINIK_KODU#A#Z,
            'c04bee57-c5d4-443d-e040-7b0a6f146a3d' AS KLINIK_KODU#C,
            TO_CHAR(CASE WHEN "HH"."ONAY_TARIHI" IS NOT NULL THEN HH.ONAY_TARIHI ELSE HH.ETAR END,'YYYYMMDDHH24MI') AS GERCEKLESME_ZAMANI#Z,
            1 AS ISLEM_TURU#K,
            USS.GET_GUID_VALUE('d03e562d-252e-451f-9a80-98d48b47c2f2',1) AS ISLEM_TURU#A,
            'd03e562d-252e-451f-9a80-98d48b47c2f2' AS ISLEM_TURU#C,
            SUBSTR(REPLACE(HZ.SUT_RESMI_KODU,'.',''),1,6) AS ISLEM_KODU#Z,
            HZ.SUT_RESMI_ADI AS ISLEM_ADI#Z,
            SUBSTR(REPLACE(HZ.GIL_RESMI_KODU,'.',''),1,6) AS GIRISIMSEL_ISLEM_KODU#Z,
            TO_CHAR(GREATEST(HH.ISTEM_TARIHI, HH.ETAR),'YYYYMMDDHH24MI') AS ISLEM_ZAMANI#Z,
            "HH"."MIKTAR" AS ADET#Z,
            CASE WHEN   ROUND(DECODE("HH"."ODEME_TURU",2, HH.MIKTAR * "HH"."HIZMET_FIYAT"),2) <= 6000
                   THEN  ROUND(DECODE(HH.ODEME_TURU,2, HH.MIKTAR * HH.HIZMET_FIYAT),2)
                 WHEN  ROUND(DECODE(HH.ODEME_TURU,2, HH.MIKTAR * HH.HIZMET_FIYAT),2) >= 6000
                   THEN (CASE WHEN ROUND(HZ.SUT_FIYAT * HH.MIKTAR)>6000 THEN 0 ELSE ROUND(HZ.SUT_FIYAT * HH.MIKTAR) END )
                 ELSE 0 END  AS HASTA_TUTARI#Z,
            CASE WHEN   ROUND(DECODE(HH.ODEME_TURU,1, HH.MIKTAR * HH.HIZMET_FIYAT),2) <= 6000
                    THEN  ROUND(DECODE(HH.ODEME_TURU,1, HH.MIKTAR * HH.HIZMET_FIYAT),2)
                 WHEN  ROUND(DECODE(HH.ODEME_TURU,1, HH.MIKTAR * HH.HIZMET_FIYAT),2) > 6000
                    THEN (CASE WHEN ROUND(HZ.SUT_FIYAT * HH.MIKTAR)>6000 THEN 0 ELSE ROUND(HZ.SUT_FIYAT * HH.MIKTAR) END)
                 ELSE 0 END AS KURUM_TUTARI#Z,
--            CASE WHEN SUBSTR (I.IS_RESMIKOD,1,1) LIKE '8%' AND SU.SR_UZMKOD_ID IN (SELECT ID FROM FONETHBYSADM.H_UZMKOD WHERE KOD IN (4400)) THEN NULL WHEN SUBSTR(I.IS_RESMIKOD,1,7)=('520.030')  THEN TO_CHAR(TO_DATE(REPLACE(X.HK_MURACAATTAR,'/','.')||' '||SUBSTR(X.HK_HASGELSAAT,1,5),'DD.MM.YYYY HH24:MI'),'YYYYMMDDHH24MI') ELSE TO_CHAR(Y.HI_EKLEMETARIHI,'YYYYMMDDHH24MI') END AS RANDEVU_ZAMANI#Z,
--            K.TCKIMLIKNO AS KULLANICI_KIMLIK_NUMARASI#Z,
--            '' AS CIHAZ_NUMARASI#Z,
--            Y.HI_ID AS ISLEM_REFERANS_NUMARASI
              BS.ID
FROM FONETHBS."HASTA_BIRIM_SEVK"/**/"BS"
INNER JOIN FONETHBS.HASTA_HIZMET HH ON HH.BIRIM_SEVK_ID = BS.ID
INNER JOIN FONETHBS.HIZMET_MAKRO M ON M.ID = HH.MAKRO_ID
INNER JOIN FONETHBS.HIZMET HZ ON HZ.ID = M.HIZMET_ID
INNER JOIN FONETHBS.HASTA_GELIS G ON G.ID = BS.HASTA_GELIS_ID
WHERE G.KODU = 6737253



/*
FROM FONETHBS."HASTA_BIRIM_SEVK"/**//*"Y"
INNER JOIN H_ISLEM I ON I.IS_ID=Y.HI_ISLEMID
INNER JOIN H_HASTAKAYIT X ON X.HK_ID=Y.HI_KAYITID
INNER JOIN FONETHBYSADM.YTK_KULLANICI K ON K.ID="Y"."HI_EKLEYEN"
LEFT JOIN FONETHBYSADM.H_SERVIS SR ON SR.SR_ID="Y"."HI_SERVISID"
LEFT JOIN FONETHBYSADM.H_SERVIS SU ON SU.SR_ID="Y"."HI_SERVISIDUST"
WHERE NVL(Y.HI_EMAKROKOD,'-') <> '+'
AND X.HK_MURACAATTAR >= '01.01.2015'
--AND X.HK_MUAYENE='E'
AND NVL(Y.HI_SERVISID,Y.HI_SERVISIDUST) > 0;
*/



